# General Context

The `general-context` workflow provides context at the highest level, i.e., in the most generic manner possible, and helps you answer the questions such as "how important is this resource?"

## Example

Say, for example, you wanted to differentiate between dev and prod resources. You can write rules to assign critical risk for prod assets and low risk for dev assets. Let's take a look at
an example:

```yaml title="content/workflows/csp/aws/general-context/general-context.yaml"
schema: 1
type: general-context

id: general-context-aws
name: General context + tag-based risk for AWS resources

csp: aws

filters:
    - match-type: all
      rules:
          - .csp=="aws" and .canonicalId and .resourceType != "AwsAccount"

steps:
    - id: getTags
      uses: GetTags
      with:
          - name: arn
            value: .canonicalId
          - name: region
            value: .region

risk-config:
    default-risk: ''
    rules:
        - name: dev enviornment risk is low
        // highlight-start
          condition: |-
              .getTags | any( select(.key | test("env" ; "ix")) | select(.value | test("dev" ; "ix")))
        // highlight-end
          risk: low

        - name: prod enviornment risk is high
          // highlight-start
          condition: |-
              .getTags | any( select(.key | test("env" ; "ix")) | select(.value | test("prod" ; "ix")))
          // highlight-end
          risk: high

output:
    - name: environment
      value: first(.getTags[] | select(.key == "env") .value)
```

As you can see, this workflow doesn't care what type of resource generated the alert. It only cares about getting tags associated with the resource (using the `GetTags` action).

## Risk config

Now, look at the highlighted section:

```javascript
.getTags | any( select(.key | test("env" ; "ix")) | select(.value | test("dev" ; "ix")))
```

This is a JQ expression. The output generated by the `GetTags` actions looks like this-

```json
[
	{
		"key": "environment",
		"value": "Development"
	}
]
```

And since the output of each step is available under the same `id`, it is defined under the following JSON and is made available to the `risk-config` component-

```json
{
	"getTags": [
		{
			"key": "environment",
			"value": "Development"
		}
	]
}
```

So to refer to this output, we use `.getTags` whose value happens to be an array. For `any` array element, we are `select` ing a `.key` and running it through a JQ function `test`.
This function tests if the key's value is `env` in a case insensitive (`ix`) manner. Next, we select the `.value` JSON key and `test`ing if it contains the word dev.

If you go to [JQ Play](https://jqplay.org/) website and paste the JSON

```json
{
	"getTags": [
		{
			"key": "enviornment",
			"value": "Development"
		}
	]
}
```

in the `JSON` box and the expression `.getTags | any( select(.key | test("env" ; "ix")) | select(.value | test("dev" ; "ix")))` in the `Filter` box, you will see `true` in the response.
As such, the condition will be met, and the risk value will be `low`. And that's what we are after- we want to say the `dev` environment risk is `low`.

---

## Reference

Following is the reference for all the available fields.

import Schema from '../../common-fields/schema.md'
import Id from '../../common-fields/workflows/workflow-id.md'
import Name from '../../common-fields/name.md'
import Labels from '../../common-fields/labels.md'
import Filters from '../../common-fields/workflows/filters.md'
import MatchType from '../../common-fields/workflows/match-type.md'
import RuleSyntax from '../../common-fields/workflows/rule-syntax.md'
import RiskConfig from '../../common-fields/workflows/risk-config.mdx'
import Steps from '../../common-fields/workflows/steps.mdx'
import Output from '../../common-fields/workflows/output.md'

### `schema`

<Schema />

### `type`

Always `general-context` for this kind of workflow.

### `id`

<Id />

### `name`

<Name />

### `labels`

<Labels />

### `csp`

Cloud service provider. A list of all supported cloud service providers can be found [here](https://github.com/dassana-io/dassana/blob/main/content/schemas/resource-hierarchy/resource-hierarchy.yaml).

### `filters`

<Filters />

#### `match-type`

<MatchType />

#### `rules`

<RuleSyntax />

### `steps`

<Steps />

### `risk-config`

<RiskConfig />

### `output`

<Output />
